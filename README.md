# Malware Analysis Lab: Malicious Document

## Project Overview

This lab demonstrates how to perform basic static and dynamic analysis on a malicious document. Using REMnux and a virtual machine environment, we will investigate an RTF file to identify the type of exploit, malicious behavior, and associated indicators of compromise (IOCs).

## Setup

1. **Create an Account on Let's Defend:**
   - Go to [Let's Defend](https://letsdefend.io).
   - Create an account if you haven't already.
   - Navigate to the "Learn" section and search for "Malicious Document."
   - Select the challenge: **Analyze Malicious .doc File**.

2. **Download and Extract the Malicious Document:**
   - Download the `factura.zip` file provided in the challenge.
   - Extract it using the password `infected` (all lowercase):
     ```bash
     unzip factura.zip -P infected
     ```
   - Verify the extracted file:
     ```bash
     ls
     # Output: factura.doc
     ```

## Static Analysis

1. **Generate File Hash:**
   - Create a SHA-256 hash of the file to use for further investigation:
     ```bash
     sha256sum factura.doc
     ```
   - Use the hash to search for the file on platforms like VirusTotal.

2. **Identify File Type and Size:**
   - Determine the file type and size using the following commands:
     ```bash
     file factura.doc
     ls -lh factura.doc
     ```

3. **Check File Timestamps:**
   - Use `exiftool` to view the file's metadata and timestamps:
     ```bash
     exiftool factura.doc
     ```

4. **Analyze RTF Content with `rtfdump`:**
   - Use `rtfdump.py` to explore the RTF structure and identify suspicious objects:
     ```bash
     rtfdump.py factura.doc
     ```

5. **Drill into Suspicious Streams:**
   - Analyze suspicious streams using the stream number from the previous output:
     ```bash
     rtfdump.py -s <stream_number> factura.doc
     ```

## Dynamic Analysis

1. **Extract and Analyze Embedded Objects:**
   - Use `rtfobj` to extract and analyze embedded objects from the RTF file:
     ```bash
     rtfobj factura.doc
     ```

2. **Analyze Extracted Binary with `oletools`:**
   - Use `oledump.py` to further analyze the extracted OLE file:
     ```bash
     oledump.py factura.doc
     ```

3. **Identify Potential Shellcode:**
   - Use `scdbg` to analyze any shellcode found in the extracted binary:
     ```bash
     scdbg -f factura.doc
     ```

4. **Check for Malicious URLs:**
   - Extract and investigate any URLs or IPs found during analysis. Use online resources like VirusTotal to gather more information.

## Findings

1. **File Analysis Summary:**
   - The document is an RTF file with embedded objects. These objects contain malicious shellcode exploiting vulnerabilities like `CVE-2017-11882`.

2. **Malicious Behavior:**
   - The document attempts to download and execute a file named `genan2.exe` from a malicious URL.

3. **Indicators of Compromise (IOCs):**
   - **Malicious URL:** `http://seed.cbc.com.ng`
   - **Malicious File:** `a.exe` dropped in `AppData` directory.

4. **Exploit Type:**
   - The file uses an RTF exploit targeting a vulnerability in `Microsoft Equation Editor` (CVE-2017-11882).

## Conclusion

This lab demonstrated the process of analyzing a malicious document using various tools in REMnux. The exercise highlighted the importance of identifying IOCs and understanding the behavior of malware without executing it on a live system.

## Resources

- [Let's Defend](https://letsdefend.io)
- Tools used: `sha256sum`, `file`, `ls`, `exiftool`, `rtfdump.py`, `rtfobj`, `oledump.py`, `scdbg`
- [VirusTotal](https://www.virustotal.com)

## Notes

Always conduct malware analysis in a controlled environment like a virtual machine. Do not open or execute malicious files on your local machine.
